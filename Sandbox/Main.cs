using System;
using System.IO;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Windows.Forms.DataVisualization.Charting;
using SpiceSharp;
using SpiceSharp.Components;
using SpiceSharp.Simulations;
using SpiceSharp.Parameters;
using SpiceSharp.Parser.Readers;
using SpiceSharp.Designer;
using SpiceSharp.Diagnostics;
using MathNet.Numerics.Interpolation;

namespace Sandbox
{
    public partial class Main : Form
    {
        private double[] timepoints = new double[]
        {
            0.000000000000000e+000, 2.000000000000000e-009, 4.000000000000000e-009, 8.000000000000001e-009, 1.600000000000000e-008,
            3.200000000000000e-008, 6.400000000000000e-008, 1.280000000000000e-007, 2.280000000000000e-007, 3.280000000000000e-007,
            4.280000000000000e-007, 5.280000000000000e-007, 6.280000000000000e-007, 7.280000000000000e-007, 8.280000000000000e-007,
            9.280000000000000e-007, 1.000000000000000e-006, 1.000100000000000e-006, 1.000300000000000e-006, 1.000509999959000e-006,
            1.000564999948250e-006, 1.000592499942875e-006, 1.000606249940187e-006, 1.000613124938844e-006, 1.000616562438172e-006,
            1.000618281187836e-006, 1.000621718687164e-006, 1.000628593685820e-006, 1.000642343683133e-006, 1.000669843677758e-006,
            1.000724843667008e-006, 1.000834843645508e-006, 1.001000000000000e-006, 1.001020000000000e-006, 1.001060000000000e-006,
            1.001140000000000e-006, 1.001300000000000e-006, 1.001620000000000e-006, 1.002259999999999e-006, 1.003539999999998e-006,
            1.006099999999996e-006, 1.011219999999992e-006, 1.021459999999983e-006, 1.041939999999967e-006, 1.082899999999933e-006,
            1.164819999999867e-006, 1.264819999999867e-006, 1.364819999999867e-006, 1.464819999999867e-006, 1.501000000000000e-006,
            1.502000000000000e-006, 1.504000000000000e-006, 1.508000000000000e-006, 1.516000000000000e-006, 1.526000000000000e-006,
            1.536000000000000e-006, 1.538500000000000e-006, 1.539750000000000e-006, 1.540062500000000e-006, 1.540218750000000e-006,
            1.540281250000000e-006, 1.540308635874791e-006, 1.540357933336017e-006, 1.540429131059782e-006, 1.540557255397014e-006,
            1.540812379164499e-006, 1.541107402348528e-006, 1.541671867657948e-006, 1.542800798276788e-006, 1.545058659514468e-006,
            1.549574381989829e-006, 1.558605826940550e-006, 1.568605826940550e-006, 1.578605826940550e-006, 1.588605826940550e-006,
            1.598605826940550e-006, 1.601000000000000e-006, 1.602000000000000e-006, 1.604000000000000e-006, 1.608000000000000e-006,
            1.616000000000000e-006, 1.632000000000000e-006, 1.664000000000000e-006, 1.728000000000000e-006, 1.828000000000000e-006,
            1.928000000000000e-006, 2.028000000000000e-006, 2.128000000000000e-006, 2.228000000000000e-006, 2.328000000000000e-006,
            2.428000000000000e-006, 2.527999999999999e-006, 2.627999999999999e-006, 2.727999999999999e-006, 2.827999999999999e-006,
            2.927999999999999e-006, 3.000000000000000e-006, 3.000100000000000e-006, 3.000144445846964e-006, 3.000233337540891e-006,
            3.000411120928747e-006, 3.000519897966882e-006, 3.000574286485950e-006, 3.000601480745484e-006, 3.000615077875251e-006,
            3.000621876440134e-006, 3.000625275722576e-006, 3.000632074287460e-006, 3.000645671417226e-006, 3.000672865676760e-006,
            3.000727254195828e-006, 3.000836031233963e-006, 3.001000000000000e-006, 3.001020000000000e-006, 3.001060000000000e-006,
            3.001140000000000e-006, 3.001300000000000e-006, 3.001620000000000e-006, 3.002260000000001e-006, 3.003540000000003e-006,
            3.006100000000005e-006, 3.011220000000011e-006, 3.021460000000022e-006, 3.041940000000044e-006, 3.082900000000089e-006,
            3.164820000000178e-006, 3.264820000000178e-006, 3.364820000000178e-006, 3.464820000000177e-006, 3.501000000000000e-006,
            3.502000000000000e-006, 3.504000000000000e-006, 3.508000000000000e-006, 3.516000000000000e-006, 3.526000000000000e-006,
            3.536000000000000e-006, 3.538500000000000e-006, 3.539750000000000e-006, 3.540062500000000e-006, 3.540218750000000e-006,
            3.540281250000000e-006, 3.540308635874792e-006, 3.540357933336019e-006, 3.540429131059785e-006, 3.540557255397020e-006,
            3.540812379164505e-006, 3.541107402348538e-006, 3.541671867657965e-006, 3.542800798276819e-006, 3.545058659514527e-006,
            3.549574381989942e-006, 3.558605826940773e-006, 3.568605826940773e-006, 3.578605826940773e-006, 3.588605826940772e-006,
            3.598605826940772e-006, 3.601000000000000e-006, 3.602000000000000e-006, 3.604000000000000e-006, 3.608000000000000e-006,
            3.616000000000000e-006, 3.632000000000000e-006, 3.664000000000000e-006, 3.728000000000000e-006, 3.828000000000000e-006,
            3.928000000000000e-006, 4.028000000000000e-006, 4.128000000000000e-006, 4.228000000000000e-006, 4.328000000000000e-006,
            4.428000000000000e-006, 4.528000000000000e-006, 4.628000000000000e-006, 4.728000000000000e-006, 4.827999999999999e-006,
            4.927999999999999e-006, 5.000000000000000e-006, 5.000100000000000e-006, 5.000144445846964e-006, 5.000233337540891e-006,
            5.000411120928746e-006, 5.000519897966881e-006, 5.000574286485949e-006, 5.000601480745483e-006, 5.000615077875250e-006,
            5.000621876440133e-006, 5.000625275722575e-006, 5.000632074287458e-006, 5.000645671417225e-006, 5.000672865676759e-006,
            5.000727254195827e-006, 5.000836031233962e-006, 5.000999999999999e-006, 5.001019999999999e-006, 5.001059999999999e-006,
            5.001140000000000e-006, 5.001300000000000e-006, 5.001620000000001e-006, 5.002260000000004e-006, 5.003540000000008e-006,
            5.006100000000016e-006, 5.011220000000033e-006, 5.021460000000068e-006, 5.041940000000137e-006, 5.082900000000274e-006,
            5.164820000000548e-006, 5.264820000000548e-006, 5.364820000000548e-006, 5.464820000000548e-006, 5.501000000000000e-006,
            5.501999999999999e-006, 5.503999999999999e-006, 5.508000000000000e-006, 5.515999999999999e-006, 5.525999999999999e-006,
            5.535999999999999e-006, 5.538500000000000e-006, 5.539750000000000e-006, 5.540062500000000e-006, 5.540218750000000e-006,
            5.540281250000000e-006, 5.540308635874791e-006, 5.540357933336018e-006, 5.540429131059784e-006, 5.540557255397017e-006,
            5.540812379164502e-006, 5.541107402348533e-006, 5.541671867657955e-006, 5.542800798276800e-006, 5.545058659514488e-006,
            5.549574381989867e-006, 5.558605826940623e-006, 5.568605826940623e-006, 5.578605826940623e-006, 5.588605826940622e-006,
            5.598605826940622e-006, 5.600999999999999e-006, 5.601999999999999e-006, 5.603999999999999e-006, 5.608000000000000e-006,
            5.615999999999999e-006, 5.632000000000000e-006, 5.664000000000000e-006, 5.727999999999999e-006, 5.827999999999999e-006,
            5.927999999999999e-006, 6.027999999999999e-006, 6.127999999999999e-006, 6.227999999999999e-006, 6.327999999999999e-006,
            6.427999999999998e-006, 6.527999999999998e-006, 6.627999999999998e-006, 6.727999999999998e-006, 6.827999999999998e-006,
            6.927999999999998e-006, 7.000000000000000e-006, 7.000100000000000e-006, 7.000144445846964e-006, 7.000233337540891e-006,
            7.000411120928746e-006, 7.000519897966881e-006, 7.000574286485949e-006, 7.000601480745483e-006, 7.000615077875250e-006,
            7.000621876440133e-006, 7.000625275722575e-006, 7.000632074287458e-006, 7.000645671417225e-006, 7.000672865676759e-006,
            7.000727254195827e-006, 7.000836031233962e-006, 7.001000000000000e-006, 7.001019999999999e-006, 7.001060000000000e-006,
            7.001140000000000e-006, 7.001300000000000e-006, 7.001620000000001e-006, 7.002260000000004e-006, 7.003540000000008e-006,
            7.006100000000017e-006, 7.011220000000034e-006, 7.021460000000068e-006, 7.041940000000137e-006, 7.082900000000274e-006,
            7.164820000000548e-006, 7.264820000000548e-006, 7.364820000000548e-006, 7.464820000000548e-006, 7.501000000000000e-006,
            7.502000000000000e-006, 7.504000000000000e-006, 7.508000000000000e-006, 7.516000000000000e-006, 7.526000000000000e-006,
            7.536000000000000e-006, 7.538500000000000e-006, 7.539750000000000e-006, 7.540062500000000e-006, 7.540218750000000e-006,
            7.540281250000000e-006, 7.540308635874792e-006, 7.540357933336018e-006, 7.540429131059784e-006, 7.540557255397017e-006,
            7.540812379164502e-006, 7.541107402348533e-006, 7.541671867657956e-006, 7.542800798276800e-006, 7.545058659514489e-006,
            7.549574381989867e-006, 7.558605826940623e-006, 7.568605826940623e-006, 7.578605826940623e-006, 7.588605826940623e-006,
            7.598605826940623e-006, 7.601000000000000e-006, 7.601999999999999e-006, 7.604000000000000e-006, 7.608000000000000e-006,
            7.616000000000000e-006, 7.631999999999999e-006, 7.664000000000000e-006, 7.728000000000000e-006, 7.828000000000000e-006,
            7.928000000000001e-006, 8.028000000000002e-006, 8.128000000000003e-006, 8.228000000000003e-006, 8.328000000000004e-006,
            8.428000000000005e-006, 8.528000000000005e-006, 8.628000000000006e-006, 8.728000000000007e-006, 8.828000000000008e-006,
            8.928000000000008e-006, 9.000000000000000e-006, 9.000100000000000e-006, 9.000144445846965e-006, 9.000233337540892e-006,
            9.000411120928747e-006, 9.000519897966883e-006, 9.000574286485950e-006, 9.000601480745485e-006, 9.000615077875251e-006,
            9.000621876440134e-006, 9.000625275722577e-006, 9.000632074287460e-006, 9.000645671417226e-006, 9.000672865676761e-006,
            9.000727254195828e-006, 9.000836031233964e-006, 9.001000000000001e-006, 9.001020000000000e-006, 9.001060000000000e-006,
            9.001140000000000e-006, 9.001300000000000e-006, 9.001619999999998e-006, 9.002259999999996e-006, 9.003539999999992e-006,
            9.006099999999983e-006, 9.011219999999965e-006, 9.021459999999931e-006, 9.041939999999861e-006, 9.082899999999723e-006,
            9.164819999999445e-006, 9.264819999999446e-006, 9.364819999999446e-006, 9.464819999999447e-006, 9.500999999999999e-006,
            9.502000000000000e-006, 9.503999999999999e-006, 9.507999999999999e-006, 9.516000000000000e-006, 9.526000000000000e-006,
            9.536000000000000e-006, 9.538500000000000e-006, 9.539750000000000e-006, 9.540062499999999e-006, 9.540218750000000e-006,
            9.540281250000000e-006, 9.540308635874790e-006, 9.540357933336016e-006, 9.540429131059782e-006, 9.540557255397014e-006,
            9.540812379164498e-006, 9.541107402348529e-006, 9.541671867657952e-006, 9.542800798276797e-006, 9.545058659514486e-006,
            9.549574381989863e-006, 9.558605826940618e-006, 9.568605826940618e-006, 9.578605826940618e-006, 9.588605826940618e-006,
            9.598605826940618e-006, 9.601000000000000e-006, 9.602000000000001e-006, 9.604000000000000e-006, 9.608000000000000e-006,
            9.616000000000001e-006, 9.632000000000000e-006, 9.664000000000001e-006, 9.728000000000001e-006, 9.828000000000001e-006,
            9.928000000000002e-006, 9.999999999999999e-006
        };
        private double[] outputpoints = new double[]
        {
            4.999999000000200e+000, 4.999999000000200e+000, 4.999999000000200e+000, 4.999999000000200e+000, 4.999999000000200e+000,
            4.999999000000200e+000, 4.999999000000200e+000, 4.999999000000201e+000, 4.999999000000200e+000, 4.999999000000200e+000,
            4.999999000000200e+000, 4.999999000000200e+000, 4.999999000000200e+000, 4.999999000000200e+000, 4.999999000000200e+000,
            4.999999000000200e+000, 4.999999000000200e+000, 5.249998975000213e+000, 5.499998925000250e+000, 5.499998899390688e+000,
            5.499998899653384e+000, 5.499998899737101e+000, 5.499998899770881e+000, 1.412522425037893e-002, -5.655464498590936e-003,
            5.914854303536648e-003, -3.790992692539855e-003, 2.913520605768479e-003, -1.614390114059650e-003, 9.796484631875609e-004,
            -4.847272938095657e-004, 2.688952697980921e-004, -1.451863941826267e-004, 4.815193465686776e-006, 4.816587493315261e-006,
            4.815323021171550e-006, 4.816587624827196e-006, 4.815323023798690e-006, 4.816587623685270e-006, 4.815323024369655e-006,
            4.816587623399792e-006, 4.815323024512392e-006, 4.816587623328419e-006, 4.815323024548078e-006, 4.816587623310576e-006,
            4.815323024557000e-006, 4.816587623305169e-006, 4.815323024561871e-006, 4.816587623300296e-006, 4.815323024571040e-006,
            4.936852606285539e-006, 5.209074955986493e-006, 5.854746795634358e-006, 7.784562212237572e-006, 1.323951644806995e-005,
            4.424349607068668e-005, 1.067580089110728e-004, 3.653172007226493e-004, 9.501709493250672e-004, 1.406043104903349e+000,
            2.688735867615471e+000, 3.244258892736244e+000, 3.936661101951831e+000, 4.492353527791712e+000, 4.884894517048920e+000,
            5.008334667787134e+000, 4.992439124622796e+000, 4.996219443936830e+000, 4.994145903871387e+000, 4.995713262468318e+000,
            4.994345325059332e+000, 4.995624353062565e+000, 4.994398172543313e+000, 4.995576267561435e+000, 4.994444372338887e+000,
            4.995531879522195e+000, 4.994548287917660e+000, 4.999503480810056e+000, 5.000404424808517e+000, 4.999632187071035e+000,
            5.000347919619239e+000, 4.999658695678694e+000, 5.000335076939670e+000, 4.999665016997630e+000, 5.000331649737556e+000,
            4.999667678205642e+000, 5.000328999153128e+000, 4.999670318208897e+000, 5.000326369688805e+000, 4.999672937176357e+000,
            5.000323761176302e+000, 4.999675535275640e+000, 5.000321173448673e+000, 4.999678112673021e+000, 5.000318606340300e+000,
            4.999680669533459e+000, 5.000315566863599e+000, 5.250157258415608e+000, 5.341011125003832e+000, 5.438851906773135e+000,
            5.496402985584989e+000, 5.498936548135180e+000, 5.499390811981081e+000, 5.499536383499129e+000, 4.447838093461272e-003,
            -1.906509689182170e-003, 1.825679393222032e-003, -1.133392287412483e-003, 8.475234799557717e-004, -4.309698621210048e-004,
            2.705721717110503e-004, -1.236673701028808e-004, 8.263532435413194e-005, 4.816322516334654e-006, 4.815629806346629e-006,
            4.816280778709326e-006, 4.815629869797967e-006, 4.816280777674647e-006, 4.815629870385731e-006, 4.816280777380763e-006,
            4.815629870532674e-006, 4.816280777307289e-006, 4.815629870569411e-006, 4.816280777288923e-006, 4.815629870578592e-006,
            4.816280777284331e-006, 4.815629870581375e-006, 4.816280777281822e-006, 4.815629870583884e-006, 4.816280777277103e-006,
            4.936852606380237e-006, 5.209074955892014e-006, 5.854746795740667e-006, 7.784562212096399e-006, 1.323951644831036e-005,
            4.424349606988606e-005, 1.067580089111109e-004, 3.653172007232493e-004, 9.501709493282818e-004, 1.406043104922522e+000,
            2.688735867635914e+000, 3.244258892757941e+000, 3.936661101970715e+000, 4.492353527806596e+000, 4.884894517057361e+000,
            5.008334667786115e+000, 4.992439124622876e+000, 4.996219443936805e+000, 4.994145903871401e+000, 4.995713262468307e+000,
            4.994345325059339e+000, 4.995624353062560e+000, 4.994398172543320e+000, 4.995576267561430e+000, 4.994444372338894e+000,
            4.995531879522191e+000, 4.994548287917669e+000, 4.999503480810047e+000, 5.000404424808525e+000, 4.999632187071028e+000,
            5.000347919619245e+000, 4.999658695678688e+000, 5.000335076939676e+000, 4.999665016997625e+000, 5.000331649737562e+000,
            4.999667678205635e+000, 5.000328999153133e+000, 4.999670318208891e+000, 5.000326369688811e+000, 4.999672937176352e+000,
            5.000323761176308e+000, 4.999675535275634e+000, 5.000321173448678e+000, 4.999678112673016e+000, 5.000318606340305e+000,
            4.999680669533452e+000, 5.000315566863606e+000, 5.250157258416668e+000, 5.341011125004735e+000, 5.438851906771054e+000,
            5.496402985583562e+000, 5.498936548133965e+000, 5.499390811983231e+000, 5.499536383496768e+000, 4.447838093725714e-003,
            -1.906509689340078e-003, 1.825679393352328e-003, -1.133392287468702e-003, 8.475234799832679e-004, -4.309698621289481e-004,
            2.705721717136972e-004, -1.236673701034556e-004, 8.263532435451488e-005, 4.816322516385651e-006, 4.815629806295635e-006,
            4.816280778760315e-006, 4.815629869746981e-006, 4.816280777725635e-006, 4.815629870334744e-006, 4.816280777431751e-006,
            4.815629870481688e-006, 4.816280777358279e-006, 4.815629870518421e-006, 4.816280777339912e-006, 4.815629870527604e-006,
            4.816280777335320e-006, 4.815629870530390e-006, 4.816280777332811e-006, 4.815629870532897e-006, 4.816280777328095e-006,
            4.936852606380187e-006, 5.209074955891947e-006, 5.854746795740589e-006, 7.784562212096267e-006, 1.323951644830995e-005,
            4.424349606988165e-005, 1.067580089110857e-004, 3.653172007229525e-004, 9.501709493261059e-004, 1.406043104909436e+000,
            2.688735867621955e+000, 3.244258892743116e+000, 3.936661101957811e+000, 4.492353527796438e+000, 4.884894517051592e+000,
            5.008334667786803e+000, 4.992439124622819e+000, 4.996219443936818e+000, 4.994145903871394e+000, 4.995713262468311e+000,
            4.994345325059335e+000, 4.995624353062563e+000, 4.994398172543318e+000, 4.995576267561432e+000, 4.994444372338891e+000,
            4.995531879522192e+000, 4.994548287917665e+000, 4.999503480810033e+000, 5.000404424808536e+000, 4.999632187071018e+000,
            5.000347919619255e+000, 4.999658695678678e+000, 5.000335076939686e+000, 4.999665016997615e+000, 5.000331649737571e+000,
            4.999667678205626e+000, 5.000328999153143e+000, 4.999670318208882e+000, 5.000326369688819e+000, 4.999672937176343e+000,
            5.000323761176317e+000, 4.999675535275625e+000, 5.000321173448687e+000, 4.999678112673007e+000, 5.000318606340314e+000,
            4.999680669533444e+000, 5.000315566863613e+000, 5.250157258416673e+000, 5.341011125004737e+000, 5.438851906771054e+000,
            5.496402985583559e+000, 5.498936548133963e+000, 5.499390811983231e+000, 5.499536383496767e+000, 4.447838093725714e-003,
            -1.906509689340078e-003, 1.825679393352313e-003, -1.133392287468702e-003, 8.475234799832679e-004, -4.309698621289481e-004,
            2.705721717136972e-004, -1.236673701034555e-004, 8.263532435504953e-005, 4.816322516446847e-006, 4.815629806234434e-006,
            4.816280778821495e-006, 4.815629869685795e-006, 4.816280777786816e-006, 4.815629870273561e-006, 4.816280777492936e-006,
            4.815629870420502e-006, 4.816280777419464e-006, 4.815629870457238e-006, 4.816280777401097e-006, 4.815629870466419e-006,
            4.816280777396505e-006, 4.815629870469205e-006, 4.816280777393997e-006, 4.815629870471711e-006, 4.816280777389278e-006,
            4.936852606380187e-006, 5.209074955891947e-006, 5.854746795740589e-006, 7.784562212096267e-006, 1.323951644830995e-005,
            4.424349606988165e-005, 1.067580089110857e-004, 3.653172007229525e-004, 9.501709493261059e-004, 1.406043104909436e+000,
            2.688735867621955e+000, 3.244258892743116e+000, 3.936661101957811e+000, 4.492353527796438e+000, 4.884894517051592e+000,
            5.008334667786803e+000, 4.992439124622819e+000, 4.996219443936818e+000, 4.994145903871394e+000, 4.995713262468311e+000,
            4.994345325059335e+000, 4.995624353062563e+000, 4.994398172543318e+000, 4.995576267561432e+000, 4.994444372338891e+000,
            4.995531879522192e+000, 4.994548287917665e+000, 4.999503480810021e+000, 5.000404424808545e+000, 4.999632187071009e+000,
            5.000347919619263e+000, 4.999658695678670e+000, 5.000335076939693e+000, 4.999665016997607e+000, 5.000331649737579e+000,
            4.999667678205618e+000, 5.000328999153150e+000, 4.999670318208874e+000, 5.000326369688828e+000, 4.999672937176335e+000,
            5.000323761176325e+000, 4.999675535275618e+000, 5.000321173448694e+000, 4.999678112672999e+000, 5.000318606340321e+000,
            4.999680669533436e+000, 5.000315566863621e+000, 5.250157258416571e+000, 5.341011125008047e+000, 5.438851906772124e+000,
            5.496402985583248e+000, 5.498936548136249e+000, 5.499390811980986e+000, 5.499536383498662e+000, 4.447838093173225e-003,
            -1.906509689231751e-003, 1.825679393180476e-003, -1.133392287395115e-003, 8.475234799656504e-004, -4.309698621183925e-004,
            2.705721717120030e-004, -1.236673701026445e-004, 8.263532435528865e-005, 4.816322516467240e-006, 4.815629806214040e-006,
            4.816280778841881e-006, 4.815629869665410e-006, 4.816280777807203e-006, 4.815629870253177e-006, 4.816280777513321e-006,
            4.815629870400115e-006, 4.816280777439849e-006, 4.815629870436853e-006, 4.816280777421482e-006, 4.815629870446037e-006,
            4.816280777416890e-006, 4.815629870448820e-006, 4.816280777414381e-006, 4.815629870451327e-006, 4.816280777409662e-006,
            4.936852606380187e-006, 5.209074955891832e-006, 5.854746795740434e-006, 7.784562212096270e-006, 1.323951644830995e-005,
            4.424349606988165e-005, 1.067580089110857e-004, 3.653172007223461e-004, 9.501709493218726e-004, 1.406043104909436e+000,
            2.688735867622002e+000, 3.244258892743173e+000, 3.936661101957852e+000, 4.492353527796445e+000, 4.884894517051629e+000,
            5.008334667786816e+000, 4.992439124622814e+000, 4.996219443936819e+000, 4.994145903871386e+000, 4.995713262468318e+000,
            4.994345325059331e+000, 4.995624353062568e+000, 4.994398172543312e+000, 4.995576267561437e+000, 4.994444372338886e+000,
            4.995531879522197e+000, 4.994548287917661e+000, 4.999503480810009e+000, 5.000404424808555e+000, 4.999632187071001e+000,
            5.000347919619272e+000, 4.999658695678662e+000, 5.000335076939701e+000, 4.999665016997599e+000, 5.000331649737587e+000,
            4.999667678205610e+000, 5.000328486217346e+000
        };

        /// <summary>
        /// Constructor
        /// </summary>
        public Main()
        {
            InitializeComponent();
            Series input = chMain.Series.Add("Input");
            input.ChartType = SeriesChartType.FastPoint;
            Series output = chMain.Series.Add("Output");
            output.ChartType = SeriesChartType.FastPoint;
            Series diff = chMain.Series.Add("Difference");
            diff.ChartType = SeriesChartType.FastPoint;
            // chMain.ChartAreas[0].AxisX.IsLogarithmic = true;

            var reference = LinearSpline.Interpolate(timepoints, outputpoints);


            // Build the circuit
            NetlistReader nr = new NetlistReader();
            string netlist = string.Join(Environment.NewLine,
                ".MODEL MM NMOS LEVEL=1 IS=1e-32",
                "+ VTO = 3.03646 LAMBDA = 0 KP = 5.28747",
                "+ CGSO = 6.5761e-06 CGDO = 1e-11",
                "M1 OUT IN GND GND MM w=100u l=100u",
                "RL VDD OUT 100k",
                "Vinput IN GND PULSE(0 5 1u 1n 0.1u 0.5u 2u)",
                "Vsupply VDD GND 5.0",
                ".tran 1n 10u"
                );
            nr.Parse(new MemoryStream(Encoding.UTF8.GetBytes(netlist)));
            nr.Netlist.OnExportSimulationData += (object sender, SimulationData data) =>
            {
                double time = data.GetTime();
                double op = data.GetVoltage("OUT");
                output.Points.AddXY(time, op);
                diff.Points.AddXY(time, op - reference.Interpolate(time));
            };
            nr.Netlist.Simulate();

            for (int i = 0; i < timepoints.Length; i++)
                input.Points.AddXY(timepoints[i], outputpoints[i]);

            // chMain.ChartAreas[0].AxisX.Maximum = 1e-8;
            chMain.ChartAreas[0].AxisX.RoundAxisValues();
        }
    }
}
